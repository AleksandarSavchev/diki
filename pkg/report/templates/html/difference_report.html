<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {{- template "_styles" }}
    <style>
        .arrow {
            border: solid black;
            border-width: 0px 3px 3px 0px;
            display: inline-block;
            padding: 4px;
        }

        .right {
            transform: rotate(-45deg);
            -webkit-transform: rotate(-45deg);
        }

        .left {
            transform: rotate(135deg);
            -webkit-transform: rotate(135deg);
        }

        .up {
            transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
        }

        .down {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }
    </style>
    <script>
        function collapse(event) {
            const parent = event.currentTarget.parentElement
            const list = parent.getElementsByTagName('ul')[0]
            const arrow = event.currentTarget.getElementsByTagName('i')[0]

            if (list.classList.contains('hidden') === true) {
                list.classList.remove('hidden')
                arrow.classList.replace('right', 'down')
                return
            }

            list.classList.add('hidden')
            arrow.classList.replace('down', 'right')
        }
    </script>
</head>

<body>
    <div class="flex-col">
        <h1 class="text-3xl font-bold pb-5 pt-2 flex justify-center">Difference report</h1>
        <div class="content px-6">
            {{- $uniqAttr := .UniqueAttributes }}
            {{- range $index, $element := .DifferenceReports }}
            <label class="font-bold text-2xl">{{ Add $index 1 }}. {{ .Title }}</label>
            {{- range .Providers }}
            {{- if (keyExists $uniqAttr .ID) }}
            <div>
                <label class="font-bold text-2xl">Provider {{ .Name }} {{ getAttrString (index $uniqAttr .ID)  . }}</label>
                <ul class="list-disc  list-inside">
                    {{- $keys := SortedMapKeys .OldMetadata }}
                    {{- $meta := .OldMetadata }}
                    <li><span class="font-bold">OldMetadata:</span>
                    {{- range $key := $keys -}}
                    <span class="font-semibold"> {{ $key }}</span>: {{ index $meta $key }},
                    {{- end -}}
                    </li>
                </ul>
                <ul class="list-disc  list-inside">
                    {{- $keys := SortedMapKeys .NewMetadata }}
                    {{- $meta := .NewMetadata }}
                    <li><span class="font-bold">NewMetadata:</span>
                    {{- range $key := $keys -}}
                    <span class="font-semibold"> {{ $key }}</span>: {{ index $meta $key }}, 
                    {{- end -}}
                    </li>
                </ul>
                <ul class="list-none list-inside">
                    {{- range .Rulesets }}
                    {{- $ruleset := . }}
                    <li>
                        <span class="text-lg"><span class="font-semibold">{{ .Version }} {{ .Name }}</span>{{ RulesetDiffSummaryText $ruleset }}</span>
                        <ul class="list-inside pl-2">
                            {{- range .Rules }}
                            <li>
                                <button onclick="collapse(event)" class="pr-2"><i
                                        class="arrow right"></i></button>
                                <span class="font-semibold">{{ .Name }}</span>
                                <ul class="list-inside pl-5 hidden">
                                    {{- if .Added }}
                                    <li>
                                        <button onclick="collapse(event)" class="pr-2"><i
                                                class="arrow right"></i></button>
                                        <span class="font-semibold">Added statuses</span>
                                        <ul class="list-inside pl-5 hidden">
                                            {{- range .Added }}
                                            <li>
                                                <span class="font-medium">{{ .Status }} &#{{ Icon .Status }} {{ .Message }}</span>
                                            </li>
                                            {{- end }}
                                        </ul>
                                    </li>
                                    {{- end }}
                                    {{- if .Removed }}
                                    <li>
                                        <button onclick="collapse(event)" class="pr-2"><i
                                                class="arrow right"></i></button>
                                        <span class="font-semibold">Removed statuses</span>
                                        <ul class="list-inside pl-5 hidden">
                                            {{- range .Removed }}
                                            <li>
                                                <span class="font-medium">{{ .Status }} &#{{ Icon .Status }} {{ .Message }}</span>
                                            </li>
                                            {{- end }}
                                        </ul>
                                    </li>
                                    {{- end }}
                                </ul>
                            </li> 
                            {{- end }}
                        </ul>
                    </li>
                    {{- end }}
                </ul>
            </div>
            {{- end }}
            <br>
            {{- end }}
            {{- end }}
        </div>
    </div>
</body>

</html>
